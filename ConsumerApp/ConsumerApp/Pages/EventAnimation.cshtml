@page
@model EventAnimationModel
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.8/signalr.min.js"></script>
<!-- Button to trigger the alert animation -->
@* <button id="start-animation" class="start-button">Show Alert</button> *@

<!-- The alert box with a circular shape -->
<div id="alert-box" class="alert-box">
    <div id="alert-icon"></div>
    <p id="alert-text">Event consumed!</p>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const alertBox = document.getElementById('alert-box');
        const alertText = document.getElementById('alert-text');
        const alertIcon = document.getElementById('alert-icon');

        // Create a connection to the SignalR hub
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/notificationHub")
            .build();

        // Start the connection
        connection.start().then(() => {
            console.log("SignalR connection established!");
        }).catch(err => {
            console.error("Error establishing SignalR connection:", err);
        });

        // Listen for the event sent from the backend
        connection.on("ReceiveEvent", (message, alertType) => {
            console.log("Event received!", message, alertType);

            if (alertBox && alertText && alertIcon) {
                // Update the text content of the alert box with the message
                alertText.textContent = message;

                // Update the icon based on the alert type
                if (alertType === "Bear") {
                    alertIcon.innerHTML = `
                                <svg xmlns="http://www.w3.org/2000/svg" width="250" height="250" viewBox="0 0 330 330" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <g id="SVGRepo_iconCarrier">
                                        <g id="XMLID_967_">
                                            <path id="XMLID_968_" style="fill:#804C09;" d="M225,150v2.924C209.077,138.671,188.053,130,165,130s-44.077,8.671-60,22.924V150 c-23.25,23.249-81.374,69.749-69.749,116.248c7.589,30.359,34.999,30.983,53.113,21.29C96.368,311.675,105,330,105,330 s56.62,0,60,0c7.318,0,60,0,60,0s8.32-18.754,16.197-42.698c18.107,9.938,45.9,9.551,53.552-21.054 C306.373,219.749,248.25,173.249,225,150z"></path>
                                            <circle id="XMLID_969_" style="fill:#402604;" cx="90" cy="35" r="35"></circle>
                                            <circle id="XMLID_970_" style="fill:#FF9811;" cx="90" cy="35" r="15"></circle>
                                            <circle id="XMLID_971_" style="fill:#804C09;" cx="240" cy="35" r="35"></circle>
                                            <circle id="XMLID_972_" style="fill:#FF9811;" cx="240" cy="35" r="15"></circle>
                                            <ellipse id="XMLID_974_" style="fill:#BE720D;" cx="165" cy="100" rx="95" ry="90"></ellipse>
                                            <circle id="XMLID_976_" style="fill:#003638;" cx="125" cy="100" r="7.5"></circle>
                                            <circle id="XMLID_977_" style="fill:#003638;" cx="205" cy="100" r="7.5"></circle>
                                            <ellipse id="XMLID_982_" style="fill:#FFC170;" cx="165" cy="150" rx="60" ry="40"></ellipse>
                                            <path id="XMLID_983_" style="fill:#FF9811;" d="M165,190c-33.137,0-60-17.908-60-40s26.863-40,60-40"></path>
                                            <path id="XMLID_984_" style="fill:#003638;" d="M185,140c0,8.836-8.954,20-20,20s-20-11.164-20-20s8.954-10,20-10 S185,131.164,185,140z"></path>
                                        </g>
                                    </g>
                                </svg>
                            `;
                } else if (alertType === "Storm") {
                    alertIcon.innerHTML = `
                              <svg height="400px" width="400px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 406.02 406.02" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <polygon style="fill:#F7CF52;" points="306.79,196.3 275.26,250.23 257.9,279.93 295.21,279.93 189.71,406.02 229.59,299.23 190.99,299.23 207.47,250.41 225.73,196.3 "></polygon> <path style="fill:#1EA6C6;" d="M347.16,126.42c24.32,9.03,41.66,32.45,41.66,59.92c0,35.28-28.61,63.89-63.89,63.89h-49.67 l31.53-53.93h-81.06l-18.26,54.11l-0.52-0.18H97.06c-44.11,0-79.86-35.76-79.86-79.87c0-38.15,26.75-70.04,62.51-77.97 c-0.01-0.52-0.02-1.04-0.02-1.57C79.69,40.66,120.35,0,170.51,0c43.22,0,79.38,30.2,88.56,70.65c8.55-4.79,18.41-7.53,28.91-7.53 c32.76,0,59.33,26.56,59.33,59.32C347.31,123.78,347.25,125.11,347.16,126.42z"></path> </g> </g></svg>
                        `;
                } else if (alertType === "Heatwave") {
                    alertIcon.innerHTML = `
                              <svg height="400px" width="400px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle style="fill:#FFDE55;" cx="255.994" cy="255.994" r="132.528"></circle> <path style="fill:#F2D546;" d="M287.014,357.51c-56.062,0-101.51-45.447-101.51-101.51s45.447-101.51,101.51-101.51 c56.062,0,101.51,45.447,101.51,101.51c0-73.191-59.334-132.525-132.525-132.525S123.475,182.809,123.475,256 S182.809,388.525,256,388.525S388.525,329.191,388.525,256C388.525,312.062,343.078,357.51,287.014,357.51z"></path> <path style="fill:#FFED9F;" d="M256,123.475c-2.966,0-5.908,0.108-8.826,0.3C316.25,128.318,370.873,185.775,370.873,256 S316.25,383.682,247.174,388.225c2.918,0.192,5.859,0.3,8.826,0.3c73.192,0,132.525-59.334,132.525-132.525 S329.191,123.475,256,123.475z"></path> <g> <path style="fill:#FFDE55;" d="M256,87.504c-3.598,0-6.516-2.917-6.516-6.516V6.516C249.484,2.917,252.402,0,256,0 c3.598,0,6.516,2.917,6.516,6.516v74.473C262.516,84.587,259.598,87.504,256,87.504z"></path> <path style="fill:#FFDE55;" d="M256,512c-3.598,0-6.516-2.917-6.516-6.516v-74.473c0-3.599,2.918-6.516,6.516-6.516 c3.598,0,6.516,2.917,6.516,6.516v74.473C262.516,509.083,259.598,512,256,512z"></path> <path style="fill:#FFDE55;" d="M379.751,138.764c-1.668,0-3.335-0.636-4.607-1.908c-2.545-2.545-2.545-6.67,0-9.214l52.661-52.661 c2.543-2.545,6.672-2.543,9.213,0c2.545,2.545,2.545,6.67,0,9.214l-52.661,52.661C383.086,138.127,381.418,138.764,379.751,138.764 z"></path> <path style="fill:#FFDE55;" d="M79.588,438.928c-1.668,0-3.335-0.636-4.607-1.908c-2.545-2.545-2.545-6.67,0-9.214l52.66-52.659 c2.542-2.543,6.671-2.545,9.213,0c2.545,2.545,2.545,6.67,0,9.214l-52.66,52.659C82.923,438.291,81.255,438.928,79.588,438.928z"></path> <path style="fill:#FFDE55;" d="M505.484,262.516h-74.473c-3.598,0-6.516-2.917-6.516-6.516s2.918-6.516,6.516-6.516h74.473 c3.598,0,6.516,2.917,6.516,6.516S509.082,262.516,505.484,262.516z"></path> <path style="fill:#FFDE55;" d="M80.988,262.516H6.516C2.918,262.516,0,259.599,0,256s2.918-6.516,6.516-6.516h74.472 c3.598,0,6.516,2.917,6.516,6.516S84.586,262.516,80.988,262.516z"></path> </g> <g> <path style="fill:#FFED9F;" d="M417.691,195.543c-2.556,0-4.983-1.515-6.022-4.024c-1.378-3.324,0.201-7.136,3.527-8.513 l19.592-8.115c3.322-1.378,7.135,0.201,8.513,3.527c1.378,3.324-0.201,7.136-3.527,8.513l-19.592,8.115 C419.368,195.383,418.522,195.543,417.691,195.543z"></path> <path style="fill:#FFED9F;" d="M74.72,337.607c-2.557,0-4.983-1.515-6.022-4.024c-1.378-3.324,0.201-7.136,3.527-8.513 l19.592-8.116c3.322-1.378,7.135,0.201,8.513,3.527c1.378,3.324-0.201,7.136-3.527,8.513l-19.592,8.116 C76.397,337.447,75.551,337.607,74.72,337.607z"></path> <path style="fill:#FFED9F;" d="M437.278,337.607c-0.832,0-1.675-0.16-2.491-0.498l-19.592-8.116 c-3.325-1.377-4.905-5.189-3.527-8.513c1.377-3.325,5.19-4.902,8.513-3.527l19.592,8.116c3.325,1.377,4.905,5.189,3.527,8.513 C442.262,336.092,439.836,337.607,437.278,337.607z"></path> <path style="fill:#FFED9F;" d="M94.308,195.543c-0.832,0-1.675-0.16-2.491-0.498l-19.592-8.115 c-3.325-1.377-4.905-5.189-3.527-8.513c1.377-3.325,5.19-4.903,8.513-3.527l19.592,8.115c3.325,1.377,4.905,5.189,3.527,8.513 C99.29,194.028,96.864,195.543,94.308,195.543z"></path> <path style="fill:#FFED9F;" d="M331.092,443.8c-2.556,0-4.983-1.515-6.022-4.024l-8.116-19.592 c-1.378-3.324,0.201-7.136,3.527-8.513c3.321-1.378,7.135,0.201,8.513,3.527l8.116,19.592c1.378,3.324-0.201,7.136-3.527,8.513 C332.769,443.64,331.923,443.8,331.092,443.8z"></path> <path style="fill:#FFED9F;" d="M189.029,100.828c-2.557,0-4.983-1.515-6.022-4.024l-8.116-19.592 c-1.378-3.324,0.201-7.136,3.527-8.513c3.322-1.378,7.135,0.201,8.513,3.527l8.116,19.592c1.378,3.324-0.201,7.136-3.527,8.513 C190.705,100.668,189.859,100.828,189.029,100.828z"></path> <path style="fill:#FFED9F;" d="M180.908,443.8c-0.832,0-1.675-0.16-2.491-0.498c-3.325-1.377-4.905-5.189-3.527-8.513l8.116-19.592 c1.377-3.325,5.189-4.902,8.513-3.527c3.325,1.377,4.905,5.189,3.527,8.513l-8.116,19.592 C185.89,442.285,183.464,443.8,180.908,443.8z"></path> <path style="fill:#FFED9F;" d="M322.971,100.828c-0.832,0-1.675-0.16-2.491-0.498c-3.325-1.377-4.905-5.189-3.527-8.513 l8.116-19.592c1.377-3.325,5.188-4.903,8.513-3.527s4.905,5.189,3.527,8.513l-8.116,19.592 C327.954,99.313,325.528,100.828,322.971,100.828z"></path> </g> <g> <path style="fill:#FFDE55;" d="M432.412,438.928c-1.667,0-3.335-0.636-4.607-1.908l-52.661-52.659c-2.545-2.545-2.545-6.67,0-9.214 c2.542-2.543,6.671-2.545,9.213,0l52.661,52.659c2.545,2.545,2.545,6.67,0,9.214C435.747,438.291,434.079,438.928,432.412,438.928z "></path> <path style="fill:#FFDE55;" d="M132.248,138.764c-1.668,0-3.335-0.636-4.607-1.908l-52.66-52.661c-2.545-2.545-2.545-6.67,0-9.214 c2.542-2.545,6.671-2.543,9.213,0l52.66,52.661c2.545,2.545,2.545,6.67,0,9.214C135.582,138.127,133.914,138.764,132.248,138.764z"></path> </g> <g> <path style="fill:#495E77;" d="M241.053,219.239c0,23.362-18.943,42.304-42.304,42.304c-7.025,0-13.659-1.718-19.488-4.75 c-13.553-7.049-22.817-21.217-22.817-37.554c0-23.362,18.943-42.304,42.304-42.304c8.139,0,15.744,2.298,22.201,6.291 C233.009,190.676,241.053,204.016,241.053,219.239z"></path> <circle style="fill:#495E77;" cx="313.249" cy="219.234" r="42.306"></circle> </g> <path style="fill:#333333;" d="M309.349,285.935c0,14.796-6.03,28.195-15.756,37.85c-9.643,9.584-22.923,15.507-37.589,15.507 c-14.666,0-27.958-5.923-37.601-15.495c-9.726-9.667-15.756-23.065-15.756-37.862L309.349,285.935L309.349,285.935z"></path> <path style="fill:#F24141;" d="M293.593,323.785c-9.643,9.584-22.923,15.507-37.589,15.507c-14.666,0-27.958-5.923-37.601-15.495 c6.089-14.773,20.625-25.174,37.601-25.174C272.968,298.623,287.504,309.013,293.593,323.785z"></path> <g> <path style="fill:#62788E;" d="M241.053,219.239c0,23.362-18.943,42.304-42.304,42.304c-7.025,0-13.659-1.718-19.488-4.75 c13.813-14.571,31.062-38.395,41.688-73.568C233.009,190.676,241.053,204.016,241.053,219.239z"></path> <path style="fill:#62788E;" d="M355.553,219.239c0,23.362-18.943,42.304-42.304,42.304c-7.025,0-13.659-1.718-19.488-4.75 c13.813-14.571,31.062-38.395,41.688-73.568C347.509,190.676,355.553,204.016,355.553,219.239z"></path> </g> <path style="fill:#F24141;" d="M387.728,191.426c-2.354-2.722-6.467-3.021-9.191-0.668l-18.175,15.709 c-5.63-20.743-24.614-36.048-47.115-36.048c-24.71,0-45.177,18.457-48.373,42.306h-17.75c-3.196-23.848-23.664-42.306-48.373-42.306 c-22.502,0-41.487,15.306-47.115,36.052l-18.177-15.712c-2.724-2.353-6.837-2.054-9.191,0.668c-2.353,2.722-2.053,6.837,0.668,9.191 l25.101,21.695c1.592,25.493,22.827,45.748,48.715,45.748c24.71,0,45.177-18.457,48.373-42.306h17.75 c3.196,23.848,23.664,42.306,48.373,42.306c25.888,0,47.124-20.257,48.715-45.752l25.097-21.692 C389.782,198.264,390.081,194.149,387.728,191.426z M198.751,255.03c-19.734,0-35.79-16.055-35.79-35.79s16.056-35.79,35.79-35.79 s35.79,16.055,35.79,35.79S218.485,255.03,198.751,255.03z M313.248,255.03c-19.734,0-35.79-16.055-35.79-35.79 s16.056-35.79,35.79-35.79c19.734,0,35.79,16.055,35.79,35.79S332.982,255.03,313.248,255.03z"></path> </g></svg>
                        `;
                }

                // Reset the animation by removing both the 'splash' and 'hide' classes
                alertBox.classList.remove('splash', 'hide');

                // Force reflow to ensure the animation restarts
                void alertBox.offsetWidth; // Trigger a reflow to restart the animation

                // Add the 'splash' class to start the animation
                alertBox.classList.add('splash');

                // After the animation finishes, hide the alert after 3 seconds
                setTimeout(() => {
                    alertBox.classList.add('hide');
                }, 5000);
            }
        });
    });
</script>
